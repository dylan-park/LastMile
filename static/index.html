<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Uber Eats Shift Tracker</title>
        <style>
            /* ===== CSS VARIABLES ===== */
            :root {
                /* Colors - Light Mode */
                --bg-primary: #ffffff;
                --bg-secondary: #f8f9fa;
                --bg-tertiary: #f1f3f5;
                --bg-hover: #e9ecef;
                --text-primary: #212529;
                --text-secondary: #495057;
                --text-muted: #6c757d;
                --border-color: #dee2e6;
                --border-light: #e9ecef;

                /* Accent Colors */
                --accent: #06c167;
                --accent-dark: #05a857;
                --accent-light: #e6f7ef;
                --secondary: #5c6ac4;
                --secondary-dark: #4c5ab8;
                --secondary-light: #eef0f9;
                --danger: #e53e3e;
                --danger-dark: #c53030;
                --danger-light: #fff5f5;

                /* Calculated Fields */
                --calculated-bg: #faf5ff;
                --calculated-text: #6b46c1;
                --calculated-border: #e9d8fd;

                /* Shadows */
                --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
                --shadow-md:
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06);
                --shadow-lg:
                    0 10px 15px -3px rgba(0, 0, 0, 0.1),
                    0 4px 6px -2px rgba(0, 0, 0, 0.05);

                /* Transitions */
                --transition-fast: 150ms ease;
                --transition-base: 200ms ease;
                --transition-slow: 300ms ease;

                /* Spacing */
                --spacing-xs: 4px;
                --spacing-sm: 8px;
                --spacing-md: 16px;
                --spacing-lg: 24px;
                --spacing-xl: 32px;
            }

            html.dark-mode {
                --bg-primary: #1a202c;
                --bg-secondary: #2d3748;
                --bg-tertiary: #4a5568;
                --bg-hover: #5a6c7d;
                --text-primary: #f7fafc;
                --text-secondary: #e2e8f0;
                --text-muted: #cbd5e0;
                --border-color: #4a5568;
                --border-light: #4a5568;

                --accent-light: #1a3a2e;
                --secondary-light: #2d3250;
                --danger-light: #3a2020;

                --calculated-bg: #2d1b4e;
                --calculated-text: #d6bcfa;
                --calculated-border: #553c7b;

                --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
                --shadow-md:
                    0 4px 6px -1px rgba(0, 0, 0, 0.4),
                    0 2px 4px -1px rgba(0, 0, 0, 0.3);
                --shadow-lg:
                    0 10px 15px -3px rgba(0, 0, 0, 0.5),
                    0 4px 6px -2px rgba(0, 0, 0, 0.4);
            }

            /* ===== MAIN STYLES ===== */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    "Helvetica Neue", Arial, sans-serif;
                background: var(--bg-secondary);
                color: var(--text-primary);
                line-height: 1.6;
                padding: var(--spacing-lg);
                transition:
                    background-color var(--transition-base),
                    color var(--transition-base);
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
            }

            /* ===== HEADER ===== */
            .header {
                margin-bottom: var(--spacing-xl);
            }

            .header-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: var(--spacing-md);
                flex-wrap: wrap;
            }

            h1 {
                display: flex;
                align-items: center;
                gap: var(--spacing-sm);
                color: var(--accent);
                font-size: 2rem;
                font-weight: 700;
                letter-spacing: -0.02em;
            }

            h1 svg {
                color: var(--accent);
            }

            .theme-toggle {
                background: var(--bg-primary);
                border: 1px solid var(--border-color);
                padding: var(--spacing-sm) var(--spacing-md);
                border-radius: 8px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: var(--spacing-sm);
                transition: all var(--transition-fast);
                box-shadow: var(--shadow-sm);
            }

            .theme-toggle:hover {
                background: var(--bg-hover);
                box-shadow: var(--shadow-md);
                transform: translateY(-1px);
            }

            .theme-toggle svg {
                color: var(--text-secondary);
            }

            /* ===== STATS GRID ===== */
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: var(--spacing-md);
                margin-bottom: var(--spacing-xl);
            }

            .stat-card {
                background: var(--bg-primary);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: var(--spacing-lg);
                display: flex;
                align-items: center;
                gap: var(--spacing-md);
                transition: all var(--transition-base);
                box-shadow: var(--shadow-sm);
            }

            .stat-card:hover {
                box-shadow: var(--shadow-md);
                transform: translateY(-2px);
            }

            .stat-icon {
                width: 48px;
                height: 48px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }

            .earnings-icon {
                background: var(--accent-light);
                color: var(--accent);
            }

            .hours-icon {
                background: var(--secondary-light);
                color: var(--secondary);
            }

            .rate-icon {
                background: #fff7ed;
                color: #ea580c;
            }

            html.dark-mode .rate-icon {
                background: #3a2817;
            }

            .miles-icon {
                background: #eff6ff;
                color: #2563eb;
            }

            html.dark-mode .miles-icon {
                background: #1e293b;
            }

            .stat-content {
                flex: 1;
            }

            .stat-label {
                font-size: 0.875rem;
                color: var(--text-muted);
                font-weight: 500;
                margin-bottom: 4px;
            }

            .stat-value {
                font-size: 1.75rem;
                font-weight: 700;
                color: var(--text-primary);
                line-height: 1;
                font-variant-numeric: tabular-nums;
            }

            /* ===== ACTIVE SHIFT BANNER ===== */
            .active-shift-banner {
                background: linear-gradient(
                    135deg,
                    var(--accent) 0%,
                    var(--accent-dark) 100%
                );
                color: white;
                padding: var(--spacing-lg);
                border-radius: 12px;
                margin-bottom: var(--spacing-lg);
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: var(--spacing-md);
                box-shadow: var(--shadow-md);
                animation: slideDown 0.3s ease;
            }

            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .banner-content {
                display: flex;
                align-items: center;
                gap: var(--spacing-md);
            }

            .banner-content strong {
                font-size: 1.125rem;
                display: block;
                margin-bottom: 4px;
            }

            .shift-info-text {
                font-size: 0.875rem;
                opacity: 0.95;
            }

            /* ===== CONTROLS SECTION ===== */
            .controls-section {
                background: var(--bg-primary);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: var(--spacing-lg);
                margin-bottom: var(--spacing-lg);
                box-shadow: var(--shadow-sm);
            }

            .shift-controls {
                display: flex;
                gap: var(--spacing-md);
                margin-bottom: var(--spacing-md);
                flex-wrap: wrap;
            }

            .odo-input {
                flex: 1;
                min-width: 200px;
            }

            .table-actions {
                display: flex;
                gap: var(--spacing-md);
                flex-wrap: wrap;
                padding-top: var(--spacing-md);
                border-top: 1px solid var(--border-color);
            }

            .search-box {
                flex: 1;
                min-width: 200px;
                position: relative;
                display: flex;
                align-items: center;
            }

            .search-box svg {
                position: absolute;
                left: 12px;
                color: var(--text-muted);
                pointer-events: none;
            }

            .search-box input {
                width: 100%;
                padding-left: 40px;
            }

            /* ===== BUTTONS ===== */
            button {
                padding: 10px 20px;
                border: none;
                border-radius: 8px;
                font-size: 0.875rem;
                font-weight: 600;
                cursor: pointer;
                transition: all var(--transition-fast);
                display: inline-flex;
                align-items: center;
                gap: var(--spacing-sm);
                white-space: nowrap;
                font-family: inherit;
            }

            button:active {
                transform: scale(0.98);
            }

            .btn-primary {
                background: var(--accent);
                color: white;
                box-shadow: var(--shadow-sm);
            }

            .btn-primary:hover {
                background: var(--accent-dark);
                box-shadow: var(--shadow-md);
            }

            .btn-secondary {
                background: var(--bg-tertiary);
                color: var(--text-primary);
                border: 1px solid var(--border-color);
            }

            .btn-secondary:hover {
                background: var(--bg-hover);
            }

            .btn-danger {
                background: var(--danger);
                color: white;
                box-shadow: var(--shadow-sm);
            }

            .btn-danger:hover {
                background: var(--danger-dark);
                box-shadow: var(--shadow-md);
            }

            .btn-export {
                background: var(--text-primary);
                color: var(--bg-primary);
            }

            .btn-export:hover {
                opacity: 0.9;
            }

            /* ===== INPUTS ===== */
            input,
            textarea {
                padding: 10px 14px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                font-size: 0.875rem;
                font-family: inherit;
                background: var(--bg-primary);
                color: var(--text-primary);
                transition: all var(--transition-fast);
            }

            input:focus,
            textarea:focus {
                outline: none;
                border-color: var(--accent);
                box-shadow: 0 0 0 3px var(--accent-light);
            }

            textarea {
                resize: vertical;
                line-height: 1.5;
            }

            /* ===== TABLE ===== */
            .table-container {
                background: var(--bg-primary);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                overflow: hidden;
                box-shadow: var(--shadow-sm);
            }

            .table-wrapper {
                overflow-x: auto;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 0.875rem;
            }

            th,
            td {
                padding: 12px 16px;
                text-align: left;
                border-bottom: 1px solid var(--border-color);
                transition: background-color var(--transition-fast);
            }

            th {
                background: var(--bg-tertiary);
                font-weight: 600;
                color: var(--text-secondary);
                position: sticky;
                top: 0;
                z-index: 10;
                cursor: pointer;
                user-select: none;
                white-space: nowrap;
            }

            th:hover {
                background: var(--bg-hover);
            }

            th[data-sort] {
                position: relative;
                padding-right: 28px;
            }

            .sort-icon {
                position: absolute;
                right: 8px;
                top: 50%;
                transform: translateY(-50%);
                opacity: 0.3;
            }

            .sort-icon::after {
                content: "⇅";
            }

            th.sort-asc .sort-icon::after {
                content: "↑";
                opacity: 1;
            }

            th.sort-desc .sort-icon::after {
                content: "↓";
                opacity: 1;
            }

            tbody tr {
                transition: background-color var(--transition-fast);
            }

            tbody tr:hover {
                background: var(--bg-hover);
            }

            tbody tr:last-child td {
                border-bottom: none;
            }

            td[contenteditable="true"] {
                cursor: text;
                position: relative;
            }

            td[contenteditable="true"]:hover {
                background: var(--accent-light);
                outline: 1px solid var(--accent);
            }

            td[contenteditable="true"]:focus {
                background: var(--bg-primary);
                outline: 2px solid var(--accent);
                box-shadow: inset 0 0 0 2px var(--accent);
            }

            .calculated {
                background: var(--calculated-bg);
                color: var(--calculated-text);
                font-weight: 600;
            }

            .money {
                text-align: right;
                font-variant-numeric: tabular-nums;
            }

            .editable-money::before {
                content: "$";
                margin-right: 2px;
                opacity: 0.6;
            }

            .notes-cell {
                max-width: 250px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .empty-state td {
                padding: var(--spacing-xl) !important;
                text-align: center;
                border: none !important;
            }

            .empty-content {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: var(--spacing-sm);
                color: var(--text-muted);
            }

            .empty-content svg {
                opacity: 0.3;
                margin-bottom: var(--spacing-sm);
            }

            .empty-content p {
                font-size: 1.125rem;
                font-weight: 600;
                color: var(--text-secondary);
            }

            /* ===== MODAL ===== */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 1000;
                animation: fadeIn 0.2s ease;
            }

            .modal.show {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }

            .modal-backdrop {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(4px);
            }

            .modal-content {
                background: var(--bg-primary);
                border-radius: 16px;
                width: 90%;
                max-width: 500px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: var(--shadow-lg);
                position: relative;
                z-index: 1001;
                animation: slideUp 0.3s ease;
            }

            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: var(--spacing-lg);
                border-bottom: 1px solid var(--border-color);
            }

            .modal-header h2 {
                color: var(--accent);
                font-size: 1.5rem;
                font-weight: 700;
            }

            .modal-close {
                background: transparent;
                padding: var(--spacing-sm);
                border-radius: 6px;
                color: var(--text-muted);
            }

            .modal-close:hover {
                background: var(--bg-hover);
                color: var(--text-primary);
            }

            .modal-body {
                padding: var(--spacing-lg);
            }

            .modal-footer {
                display: flex;
                gap: var(--spacing-md);
                padding: var(--spacing-lg);
                border-top: 1px solid var(--border-color);
                justify-content: flex-end;
            }

            .form-group {
                margin-bottom: var(--spacing-md);
            }

            .form-group:last-child {
                margin-bottom: 0;
            }

            .form-group label {
                display: block;
                margin-bottom: var(--spacing-sm);
                font-weight: 600;
                color: var(--text-secondary);
                font-size: 0.875rem;
            }

            .required {
                color: var(--danger);
            }

            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: var(--spacing-md);
            }

            .input-with-icon {
                position: relative;
            }

            .input-icon {
                position: absolute;
                left: 14px;
                top: 50%;
                transform: translateY(-50%);
                color: var(--text-muted);
                font-weight: 500;
            }

            .input-with-icon input {
                padding-left: 32px;
            }

            .form-group input,
            .form-group textarea {
                width: 100%;
            }

            /* ===== TOAST ===== */
            .toast {
                position: fixed;
                bottom: var(--spacing-lg);
                right: var(--spacing-lg);
                background: var(--text-primary);
                color: var(--bg-primary);
                padding: var(--spacing-md) var(--spacing-lg);
                border-radius: 10px;
                box-shadow: var(--shadow-lg);
                transform: translateY(100px);
                opacity: 0;
                transition: all var(--transition-base);
                z-index: 2000;
                max-width: 400px;
                font-weight: 500;
            }

            .toast.show {
                transform: translateY(0);
                opacity: 1;
            }

            .toast.success {
                background: var(--accent);
                color: white;
            }

            .toast.error {
                background: var(--danger);
                color: white;
            }

            /* ===== LOADING ===== */
            .loading-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(2px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 3000;
            }

            .spinner {
                width: 48px;
                height: 48px;
                border: 4px solid var(--bg-primary);
                border-top-color: var(--accent);
                border-radius: 50%;
                animation: spin 0.8s linear infinite;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            /* ===== UTILITIES ===== */
            .hidden {
                display: none !important;
            }

            /* ===== RESPONSIVE ===== */
            @media (max-width: 768px) {
                body {
                    padding: var(--spacing-md);
                }

                h1 {
                    font-size: 1.5rem;
                }

                .stats-grid {
                    grid-template-columns: 1fr 1fr;
                }

                .stat-value {
                    font-size: 1.5rem;
                }

                .active-shift-banner {
                    flex-direction: column;
                    align-items: flex-start;
                }

                .shift-controls {
                    flex-direction: column;
                }

                .odo-input,
                .shift-controls button {
                    width: 100%;
                }

                .table-actions {
                    flex-direction: column;
                }

                .search-box {
                    width: 100%;
                }

                th,
                td {
                    padding: 8px 12px;
                    font-size: 0.8125rem;
                }

                .notes-cell {
                    max-width: 150px;
                }

                .form-row {
                    grid-template-columns: 1fr;
                }

                .modal-footer {
                    flex-direction: column;
                }

                .modal-footer button {
                    width: 100%;
                }
            }

            @media (max-width: 480px) {
                .stats-grid {
                    grid-template-columns: 1fr;
                }

                .stat-card {
                    padding: var(--spacing-md);
                }

                .stat-icon {
                    width: 40px;
                    height: 40px;
                }

                .stat-value {
                    font-size: 1.25rem;
                }

                th,
                td {
                    padding: 6px 8px;
                    font-size: 0.75rem;
                }

                button {
                    padding: 12px 16px;
                    font-size: 0.9375rem;
                }
            }
        </style>
    </head>
    <body>
        <!-- Toast Notification -->
        <div id="toast" class="toast"></div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="spinner"></div>
        </div>

        <div class="container">
            <!-- Header -->
            <header class="header">
                <div class="header-content">
                    <h1>
                        <svg
                            width="30"
                            height="30"
                            viewBox="0 0 60 60"
                            fill="currentColor"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        >
                            <path
                                class="st0"
                                d="M39.9,3.5L59.3,30L39.9,56.5H32l17-23.1H0.7v-6.8H49L32,3.5H39.9z"
                            />
                        </svg>
                        Uber Eats Shift Tracker
                    </h1>
                    <button
                        class="theme-toggle"
                        id="themeToggle"
                        aria-label="Toggle theme"
                    >
                        <svg
                            class="sun-icon"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line
                                x1="4.22"
                                y1="4.22"
                                x2="5.64"
                                y2="5.64"
                            ></line>
                            <line
                                x1="18.36"
                                y1="18.36"
                                x2="19.78"
                                y2="19.78"
                            ></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line
                                x1="4.22"
                                y1="19.78"
                                x2="5.64"
                                y2="18.36"
                            ></line>
                            <line
                                x1="18.36"
                                y1="5.64"
                                x2="19.78"
                                y2="4.22"
                            ></line>
                        </svg>
                        <svg
                            class="moon-icon hidden"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                            ></path>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Stats Dashboard -->
            <section class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-icon earnings-icon">
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path
                                d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"
                            ></path>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Total Earnings</div>
                        <div class="stat-value" id="statTotalEarnings">
                            $0.00
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon hours-icon">
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Total Hours</div>
                        <div class="stat-value" id="statTotalHours">0.0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon rate-icon">
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Avg Hourly Rate</div>
                        <div class="stat-value" id="statAvgRate">$0.00</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon miles-icon">
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <circle cx="12" cy="12" r="10"></circle>
                            <path
                                d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"
                            ></path>
                            <path d="M2 12h20"></path>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Total Miles</div>
                        <div class="stat-value" id="statTotalMiles">0</div>
                    </div>
                </div>
            </section>

            <!-- Active Shift Banner -->
            <div id="activeShiftBanner" class="active-shift-banner hidden">
                <div class="banner-content">
                    <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <div>
                        <strong>Shift in Progress</strong>
                        <div id="shiftInfo" class="shift-info-text"></div>
                    </div>
                </div>
                <button class="btn-danger" id="endShiftBtn">End Shift</button>
            </div>

            <!-- Shift Controls -->
            <section class="controls-section">
                <div id="startShiftSection" class="shift-controls">
                    <input
                        type="number"
                        id="startOdo"
                        placeholder="Starting Odometer"
                        min="0"
                        class="odo-input"
                    />
                    <button class="btn-primary" id="startShiftBtn">
                        <svg
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Start Shift
                    </button>
                </div>

                <div class="table-actions">
                    <div class="search-box">
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="Search shifts..."
                        />
                    </div>
                    <button class="btn-export" id="exportBtn">
                        <svg
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                            ></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export CSV
                    </button>
                </div>
            </section>

            <!-- Shifts Table -->
            <div class="table-container">
                <div class="table-wrapper">
                    <table id="shiftsTable">
                        <thead>
                            <tr>
                                <th data-sort="id">
                                    ID <span class="sort-icon"></span>
                                </th>
                                <th data-sort="start_time">
                                    Start Time <span class="sort-icon"></span>
                                </th>
                                <th data-sort="end_time">
                                    End Time <span class="sort-icon"></span>
                                </th>
                                <th class="calculated" data-sort="hours_worked">
                                    Hours <span class="sort-icon"></span>
                                </th>
                                <th>Odo Start</th>
                                <th>Odo End</th>
                                <th class="calculated">Miles</th>
                                <th class="money">Earnings</th>
                                <th class="money">Tips</th>
                                <th class="money">Gas</th>
                                <th class="money calculated">Total</th>
                                <th class="money calculated">$/Hr</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody id="shiftsBody">
                            <tr class="empty-state">
                                <td colspan="13">
                                    <div class="empty-content">
                                        <svg
                                            width="48"
                                            height="48"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="1.5"
                                        >
                                            <rect
                                                x="3"
                                                y="4"
                                                width="18"
                                                height="18"
                                                rx="2"
                                                ry="2"
                                            ></rect>
                                            <line
                                                x1="16"
                                                y1="2"
                                                x2="16"
                                                y2="6"
                                            ></line>
                                            <line
                                                x1="8"
                                                y1="2"
                                                x2="8"
                                                y2="6"
                                            ></line>
                                            <line
                                                x1="3"
                                                y1="10"
                                                x2="21"
                                                y2="10"
                                            ></line>
                                        </svg>
                                        <p>No shifts recorded yet</p>
                                        <small
                                            >Start your first shift to begin
                                            tracking</small
                                        >
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- End Shift Modal -->
        <div id="endShiftModal" class="modal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>End Shift</h2>
                    <button
                        class="modal-close"
                        id="modalClose"
                        aria-label="Close modal"
                    >
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="form-group">
                        <label for="endOdo"
                            >Ending Odometer
                            <span class="required">*</span></label
                        >
                        <input type="number" id="endOdo" min="0" required />
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="earnings">Earnings</label>
                            <div class="input-with-icon">
                                <span class="input-icon">$</span>
                                <input
                                    type="number"
                                    id="earnings"
                                    step="0.01"
                                    min="0"
                                    value="0"
                                />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="tips">Tips</label>
                            <div class="input-with-icon">
                                <span class="input-icon">$</span>
                                <input
                                    type="number"
                                    id="tips"
                                    step="0.01"
                                    min="0"
                                    value="0"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="gasCost">Gas Cost</label>
                        <div class="input-with-icon">
                            <span class="input-icon">$</span>
                            <input
                                type="number"
                                id="gasCost"
                                step="0.01"
                                min="0"
                                value="0"
                            />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="notes">Notes</label>
                        <textarea
                            id="notes"
                            placeholder="Optional notes about this shift..."
                            rows="3"
                        ></textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn-secondary" id="modalCancel">
                        Cancel
                    </button>
                    <button class="btn-primary" id="modalSubmit">
                        <svg
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Complete Shift
                    </button>
                </div>
            </div>
        </div>

        <script>
            // ===== UTILS.JS =====
            const USER_TIMEZONE = "America/Chicago";

            function formatDateTime(utcDateString) {
                if (!utcDateString) return "";

                try {
                    const date = new Date(utcDateString + "Z");
                    return new Intl.DateTimeFormat("en-US", {
                        year: "numeric",
                        month: "2-digit",
                        day: "2-digit",
                        hour: "2-digit",
                        minute: "2-digit",
                        second: "2-digit",
                        timeZone: USER_TIMEZONE,
                    }).format(date);
                } catch (error) {
                    console.error("Error formatting date:", error);
                    return utcDateString;
                }
            }

            function formatMoney(value) {
                return parseFloat(value || 0).toFixed(2);
            }

            function formatHours(value) {
                return value ? parseFloat(value).toFixed(2) : "";
            }

            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // ===== API.JS =====
            const API_URL = "http://localhost:8031/api";

            const API = {
                async getShifts() {
                    const response = await fetch(`${API_URL}/shifts`);
                    if (!response.ok) throw new Error("Failed to fetch shifts");
                    return await response.json();
                },

                async getActiveShift() {
                    const response = await fetch(`${API_URL}/shifts/active`);
                    if (!response.ok)
                        throw new Error("Failed to fetch active shift");
                    return await response.json();
                },

                async startShift(odometerStart) {
                    const response = await fetch(`${API_URL}/shifts/start`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ odometer_start: odometerStart }),
                    });
                    if (!response.ok) {
                        if (response.status === 409) {
                            throw new Error("CONFLICT");
                        }
                        throw new Error("Failed to start shift");
                    }
                    return await response.json();
                },

                async endShift(shiftId, data) {
                    const response = await fetch(
                        `${API_URL}/shifts/${shiftId}/end`,
                        {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(data),
                        },
                    );
                    if (!response.ok) throw new Error("Failed to end shift");
                    return await response.json();
                },

                async updateShift(shiftId, data) {
                    const response = await fetch(
                        `${API_URL}/shifts/${shiftId}`,
                        {
                            method: "PUT",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(data),
                        },
                    );
                    if (!response.ok) throw new Error("Failed to update shift");
                    return await response.json();
                },

                async exportCSV() {
                    const response = await fetch(`${API_URL}/shifts/export`);
                    if (!response.ok) throw new Error("Failed to export CSV");
                    return await response.blob();
                },
            };

            // ===== UI.JS =====
            const UI = {
                showToast(message, type = "info") {
                    const toast = document.getElementById("toast");
                    toast.textContent = message;
                    toast.className = `toast show ${type}`;

                    setTimeout(() => {
                        toast.className = "toast";
                    }, 3000);
                },

                showLoading() {
                    document
                        .getElementById("loadingOverlay")
                        .classList.remove("hidden");
                },

                hideLoading() {
                    document
                        .getElementById("loadingOverlay")
                        .classList.add("hidden");
                },

                updateStats(shifts) {
                    const completed = shifts.filter((s) => s.end_time);

                    const totalEarnings = completed.reduce(
                        (sum, s) => sum + parseFloat(s.day_total || 0),
                        0,
                    );
                    const totalHours = completed.reduce(
                        (sum, s) => sum + parseFloat(s.hours_worked || 0),
                        0,
                    );
                    const totalMiles = completed.reduce(
                        (sum, s) => sum + parseFloat(s.miles_driven || 0),
                        0,
                    );
                    const avgRate =
                        totalHours > 0 ? totalEarnings / totalHours : 0;

                    document.getElementById("statTotalEarnings").textContent =
                        `${formatMoney(totalEarnings)}`;
                    document.getElementById("statTotalHours").textContent =
                        formatHours(totalHours);
                    document.getElementById("statAvgRate").textContent =
                        `${formatMoney(avgRate)}`;
                    document.getElementById("statTotalMiles").textContent =
                        Math.round(totalMiles);
                },

                updateActiveShiftBanner(shift) {
                    const banner = document.getElementById("activeShiftBanner");
                    const startSection =
                        document.getElementById("startShiftSection");

                    if (shift) {
                        banner.classList.remove("hidden");
                        startSection.style.display = "none";

                        const startTime = formatDateTime(shift.start_time);
                        document.getElementById("shiftInfo").textContent =
                            `Started at ${startTime} | Odometer: ${shift.odometer_start}`;
                    } else {
                        banner.classList.add("hidden");
                        startSection.style.display = "flex";
                    }
                },

                renderShifts(shifts, searchTerm = "") {
                    const tbody = document.getElementById("shiftsBody");

                    const filtered = shifts.filter((shift) => {
                        if (!searchTerm) return true;
                        const search = searchTerm.toLowerCase();
                        return (
                            shift.id.toString().includes(search) ||
                            (shift.notes &&
                                shift.notes.toLowerCase().includes(search)) ||
                            formatDateTime(shift.start_time)
                                .toLowerCase()
                                .includes(search) ||
                            formatDateTime(shift.end_time)
                                .toLowerCase()
                                .includes(search)
                        );
                    });

                    if (filtered.length === 0) {
                        tbody.innerHTML = `
                <tr class="empty-state">
                    <td colspan="13">
                        <div class="empty-content">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <p>${searchTerm ? "No shifts found" : "No shifts recorded yet"}</p>
                            <small>${searchTerm ? "Try a different search term" : "Start your first shift to begin tracking"}</small>
                        </div>
                    </td>
                </tr>
            `;
                        return;
                    }

                    tbody.innerHTML = filtered
                        .map(
                            (shift) => `
            <tr data-shift-id="${shift.id}">
                <td>${shift.id}</td>
                <td>${formatDateTime(shift.start_time)}</td>
                <td>${formatDateTime(shift.end_time)}</td>
                <td class="calculated">${formatHours(shift.hours_worked)}</td>
                <td contenteditable="true" data-field="odometer_start" data-id="${shift.id}">${shift.odometer_start}</td>
                <td contenteditable="true" data-field="odometer_end" data-id="${shift.id}">${shift.odometer_end || ""}</td>
                <td class="calculated">${shift.miles_driven || ""}</td>
                <td class="money editable-money" contenteditable="true" data-field="earnings" data-id="${shift.id}">${formatMoney(shift.earnings)}</td>
                <td class="money editable-money" contenteditable="true" data-field="tips" data-id="${shift.id}">${formatMoney(shift.tips)}</td>
                <td class="money editable-money" contenteditable="true" data-field="gas_cost" data-id="${shift.id}">${formatMoney(shift.gas_cost)}</td>
                <td class="money calculated">$${formatMoney(shift.day_total)}</td>
                <td class="money calculated">$${shift.hourly_pay ? formatMoney(shift.hourly_pay) : ""}</td>
                <td class="notes-cell" contenteditable="true" data-field="notes" data-id="${shift.id}" title="${shift.notes || ""}">${shift.notes || ""}</td>
            </tr>
        `,
                        )
                        .join("");

                    this.attachCellEditListeners();
                },

                attachCellEditListeners() {
                    document
                        .querySelectorAll('td[contenteditable="true"]')
                        .forEach((cell) => {
                            cell.addEventListener("blur", handleCellEdit);
                            cell.addEventListener("keydown", (e) => {
                                if (e.key === "Enter" && !e.shiftKey) {
                                    e.preventDefault();
                                    cell.blur();
                                }
                            });
                        });
                },

                setupTableSorting() {
                    document.querySelectorAll("th[data-sort]").forEach((th) => {
                        th.addEventListener("click", () => {
                            const sortField = th.dataset.sort;
                            const currentSort = th.classList.contains(
                                "sort-asc",
                            )
                                ? "asc"
                                : th.classList.contains("sort-desc")
                                  ? "desc"
                                  : null;

                            document
                                .querySelectorAll("th")
                                .forEach((header) => {
                                    header.classList.remove(
                                        "sort-asc",
                                        "sort-desc",
                                    );
                                });

                            if (currentSort === "asc") {
                                th.classList.add("sort-desc");
                                sortTable(sortField, "desc");
                            } else {
                                th.classList.add("sort-asc");
                                sortTable(sortField, "asc");
                            }
                        });
                    });
                },

                openModal() {
                    const modal = document.getElementById("endShiftModal");
                    modal.classList.add("show");
                    document.body.style.overflow = "hidden";
                },

                closeModal() {
                    const modal = document.getElementById("endShiftModal");
                    modal.classList.remove("show");
                    document.body.style.overflow = "";

                    document.getElementById("endOdo").value = "";
                    document.getElementById("earnings").value = "0";
                    document.getElementById("tips").value = "0";
                    document.getElementById("gasCost").value = "0";
                    document.getElementById("notes").value = "";
                },
            };

            // ===== APP.JS =====
            let activeShift = null;
            let allShifts = [];

            async function loadShifts() {
                try {
                    allShifts = await API.getShifts();
                    UI.updateStats(allShifts);
                    const searchTerm =
                        document.getElementById("searchInput").value;
                    UI.renderShifts(allShifts, searchTerm);
                } catch (error) {
                    console.error("Error loading shifts:", error);
                    UI.showToast("Failed to load shifts", "error");
                }
            }

            async function checkActiveShift() {
                try {
                    activeShift = await API.getActiveShift();
                    UI.updateActiveShiftBanner(activeShift);
                } catch (error) {
                    console.error("Error checking active shift:", error);
                }
            }

            async function handleStartShift() {
                const odoStart = document.getElementById("startOdo").value;

                if (!odoStart) {
                    UI.showToast(
                        "Please enter starting odometer reading",
                        "error",
                    );
                    return;
                }

                try {
                    UI.showLoading();
                    await API.startShift(parseInt(odoStart));
                    document.getElementById("startOdo").value = "";
                    await checkActiveShift();
                    await loadShifts();
                    UI.showToast("Shift started successfully", "success");
                } catch (error) {
                    if (error.message === "CONFLICT") {
                        UI.showToast(
                            "There is already an active shift",
                            "error",
                        );
                    } else {
                        UI.showToast("Failed to start shift", "error");
                    }
                } finally {
                    UI.hideLoading();
                }
            }

            async function handleEndShift() {
                const endOdo = document.getElementById("endOdo").value;

                if (!endOdo) {
                    UI.showToast(
                        "Please enter ending odometer reading",
                        "error",
                    );
                    return;
                }

                const earnings =
                    parseFloat(document.getElementById("earnings").value) || 0;
                const tips =
                    parseFloat(document.getElementById("tips").value) || 0;
                const gasCost =
                    parseFloat(document.getElementById("gasCost").value) || 0;
                const notes =
                    document.getElementById("notes").value.trim() || null;

                try {
                    UI.showLoading();
                    await API.endShift(activeShift.id, {
                        odometer_end: parseInt(endOdo),
                        earnings,
                        tips,
                        gas_cost: gasCost,
                        notes,
                    });
                    UI.closeModal();
                    await checkActiveShift();
                    await loadShifts();
                    UI.showToast("Shift ended successfully", "success");
                } catch (error) {
                    UI.showToast("Failed to end shift", "error");
                } finally {
                    UI.hideLoading();
                }
            }

            async function handleCellEdit(e) {
                const cell = e.target;
                const field = cell.dataset.field;
                const id = cell.dataset.id;
                let value = cell.textContent.trim();

                if (["odometer_start", "odometer_end"].includes(field)) {
                    value = value ? parseInt(value) : null;
                } else if (["earnings", "tips", "gas_cost"].includes(field)) {
                    value = value ? parseFloat(value) : 0;
                } else if (field === "notes") {
                    value = value.length === 0 ? "" : value;
                }

                try {
                    const payload = {};
                    payload[field] = value;

                    await API.updateShift(id, payload);
                    await loadShifts();
                } catch (error) {
                    console.error("Error updating shift:", error);
                    UI.showToast("Failed to update shift", "error");
                    await loadShifts();
                }
            }

            async function handleExportCSV() {
                try {
                    UI.showLoading();
                    const blob = await API.exportCSV();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "uber_eats_shifts.csv";
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    UI.showToast("CSV exported successfully", "success");
                } catch (error) {
                    console.error("Error exporting CSV:", error);
                    UI.showToast("Failed to export CSV", "error");
                } finally {
                    UI.hideLoading();
                }
            }

            function sortTable(field, direction) {
                const sorted = [...allShifts].sort((a, b) => {
                    let aVal = a[field];
                    let bVal = b[field];

                    if (field === "start_time" || field === "end_time") {
                        aVal = aVal ? new Date(aVal) : new Date(0);
                        bVal = bVal ? new Date(bVal) : new Date(0);
                    } else if (typeof aVal === "string") {
                        aVal = aVal.toLowerCase();
                        bVal = bVal ? bVal.toLowerCase() : "";
                    } else {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    }

                    if (direction === "asc") {
                        return aVal > bVal ? 1 : -1;
                    } else {
                        return aVal < bVal ? 1 : -1;
                    }
                });

                const searchTerm = document.getElementById("searchInput").value;
                UI.renderShifts(sorted, searchTerm);
            }

            function toggleTheme() {
                document.documentElement.classList.toggle("dark-mode");
                const isDark =
                    document.documentElement.classList.contains("dark-mode");
                localStorage.setItem("theme", isDark ? "dark" : "light");
                updateThemeButton();
            }

            function updateThemeButton() {
                const isDark =
                    document.documentElement.classList.contains("dark-mode");
                const sunIcon = document.querySelector(".sun-icon");
                const moonIcon = document.querySelector(".moon-icon");

                if (isDark) {
                    sunIcon.classList.add("hidden");
                    moonIcon.classList.remove("hidden");
                } else {
                    sunIcon.classList.remove("hidden");
                    moonIcon.classList.add("hidden");
                }
            }

            const debouncedSearch = debounce((searchTerm) => {
                UI.renderShifts(allShifts, searchTerm);
            }, 300);

            // Initialize
            document.addEventListener("DOMContentLoaded", () => {
                if (localStorage.getItem("theme") === "dark") {
                    document.documentElement.classList.add("dark-mode");
                }
                updateThemeButton();

                document
                    .getElementById("themeToggle")
                    .addEventListener("click", toggleTheme);
                document
                    .getElementById("startShiftBtn")
                    .addEventListener("click", handleStartShift);
                document
                    .getElementById("endShiftBtn")
                    .addEventListener("click", () => UI.openModal());
                document
                    .getElementById("exportBtn")
                    .addEventListener("click", handleExportCSV);
                document
                    .getElementById("modalClose")
                    .addEventListener("click", () => UI.closeModal());
                document
                    .getElementById("modalCancel")
                    .addEventListener("click", () => UI.closeModal());
                document
                    .getElementById("modalSubmit")
                    .addEventListener("click", handleEndShift);

                document
                    .getElementById("searchInput")
                    .addEventListener("input", (e) => {
                        debouncedSearch(e.target.value);
                    });

                document
                    .querySelector(".modal-backdrop")
                    .addEventListener("click", () => UI.closeModal());

                document
                    .getElementById("startOdo")
                    .addEventListener("keypress", (e) => {
                        if (e.key === "Enter") {
                            handleStartShift();
                        }
                    });

                UI.setupTableSorting();

                checkActiveShift();
                loadShifts();
            });
        </script>
    </body>
</html>
